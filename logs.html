<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs - Army Weapons Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    
    <!-- Navbar -->
    <nav class="bg-gray-800 p-4 shadow-lg flex justify-between">
        <h1 class="text-2xl font-bold">Army Weapons Management</h1>
        <ul class="flex space-x-4 ml-auto">
            <li><a href="Dashboard.html" class="hover:text-gray-300">Dashboard</a></li>
            <li><a href="weapons.html" class="hover:text-gray-300">Weapons</a></li>
            <li><a href="ammunition.html" class="hover:text-gray-300">Ammunition</a></li>
            <li><a href="personnel.html" class="hover:text-gray-300">Personnel</a></li>
            <li><a href="storage.html" class="hover:text-gray-300">Storage</a></li>
            <li><a href="logs.html" class="hover:text-gray-300 font-bold">Logs</a></li>
        </ul>
    </nav>
    
    <!-- Logs Management -->
    <section id="logs" class="p-6">
        <h2 class="text-3xl font-bold mb-6">Activity Logs</h2>
        
        <!-- Search and Add Section -->
        <div class="flex justify-between mb-6">
            <div class="w-1/3">
                <input type="text" id="searchLogs" placeholder="Search logs..." 
                    class="w-full p-2 bg-gray-700 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <button id="addLogBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md">
                Add New Log Entry
            </button>
        </div>
        
        <!-- Filter Controls - Fix vertical alignment -->
        <div class="flex justify-between mb-6">
            <div class="flex space-x-4">
                <div>
                    <label for="logDateFilter" class="block mb-1">Filter by Date:</label>
                    <input type="date" id="logDateFilter" class="p-2 bg-gray-700 rounded-md border border-gray-600 w-48">
                </div>
                <div>
                    <label for="logTypeFilter" class="block mb-1">Filter by Type:</label>
                    <select id="logTypeFilter" class="p-2 bg-gray-700 rounded-md border border-gray-600">
                        <option value="">All Types</option>
                        <option value="Checkout">Checkout</option>
                        <option value="Return">Return</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Inspection">Inspection</option>
                        <option value="Incident">Incident</option>
                    </select>
                </div>
            </div>
            <div> 
                <label class="invisible block mb-1">Action</label> 
                <button id="clearFiltersBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-md">
                    Clear Filters
                </button>
            </div>
        </div>
        
        <!-- Logs Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full bg-gray-800 rounded-lg overflow-hidden">
                <thead class="bg-gray-700">
                    <tr>
                        <th class="py-3 px-4 text-left">ID</th>
                        <th class="py-3 px-4 text-left">Date & Time</th>
                        <th class="py-3 px-4 text-left">Type</th>
                        <th class="py-3 px-4 text-left">Item</th>
                        <th class="py-3 px-4 text-left">Personnel</th>
                        <th class="py-3 px-4 text-left">Description</th>
                        <th class="py-3 px-4 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody id="logsTableBody">
                    <!-- Sample data, will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </section>
    
    <!-- Add/Edit Log Modal -->
    <div id="logModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-gray-800 p-6 rounded-lg w-1/2">
            <h3 id="modalTitle" class="text-xl font-bold mb-4">Add New Log Entry</h3>
            <form id="logForm">
                <input type="hidden" id="logId">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="logDateTime" class="block mb-1">Date & Time</label>
                        <input type="datetime-local" id="logDateTime" class="w-full p-2 bg-gray-700 rounded-md border border-gray-600">
                    </div>
                    <div>
                        <label for="logType" class="block mb-1">Type</label>
                        <select id="logType" class="w-full p-2 bg-gray-700 rounded-md border border-gray-600">
                            <option value="Checkout">Checkout</option>
                            <option value="Return">Return</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Inspection">Inspection</option>
                            <option value="Incident">Incident</option>
                        </select>
                    </div>
                    <div>
                        <label for="logItem" class="block mb-1">Item</label>
                        <input type="text" id="logItem" class="w-full p-2 bg-gray-700 rounded-md border border-gray-600">
                    </div>
                    <div>
                        <label for="logPersonnel" class="block mb-1">Personnel</label>
                        <input type="text" id="logPersonnel" class="w-full p-2 bg-gray-700 rounded-md border border-gray-600">
                    </div>
                    <div class="col-span-2">
                        <label for="logDescription" class="block mb-1">Description</label>
                        <textarea id="logDescription" rows="3" class="w-full p-2 bg-gray-700 rounded-md border border-gray-600"></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancelLogBtn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-md">Cancel</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center p-4 bg-gray-800 mt-6">
        <p>Â© 2025 Army Weapons Management System</p>
    </footer>

    <script>
        // Sample logs data
        let logs = [
            { 
                id: 1, 
                dateTime: "2025-03-20T09:30", 
                type: "Checkout", 
                item: "M4A1", 
                personnel: "John Doe",
                description: "Weapon checked out for training exercise."
            },
            { 
                id: 2, 
                dateTime: "2025-03-21T14:15", 
                type: "Return", 
                item: "M4A1", 
                personnel: "John Doe",
                description: "Weapon returned after training exercise. Condition: Good."
            },
            { 
                id: 3, 
                dateTime: "2025-03-22T10:00", 
                type: "Maintenance", 
                item: "M249", 
                personnel: "Tech Specialist Wilson",
                description: "Routine maintenance performed. Parts replaced: firing pin."
            }
        ];

        // DOM elements
        const searchLogs = document.getElementById('searchLogs');
        const logsTableBody = document.getElementById('logsTableBody');
        const addLogBtn = document.getElementById('addLogBtn');
        const logModal = document.getElementById('logModal');
        const modalTitle = document.getElementById('modalTitle');
        const logForm = document.getElementById('logForm');
        const cancelLogBtn = document.getElementById('cancelLogBtn');
        const logIdInput = document.getElementById('logId');
        const logDateFilter = document.getElementById('logDateFilter');
        const logTypeFilter = document.getElementById('logTypeFilter');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');

        // Format date for display
        function formatDateTime(dateTimeStr) {
            const date = new Date(dateTimeStr);
            return date.toLocaleString();
        }

        // Get type badge class
        function getTypeBadgeClass(type) {
            switch(type) {
                case 'Checkout': return 'bg-blue-700';
                case 'Return': return 'bg-green-700';
                case 'Maintenance': return 'bg-yellow-700';
                case 'Inspection': return 'bg-purple-700';
                case 'Incident': return 'bg-red-700';
                default: return 'bg-gray-600';
            }
        }

        // Render logs table
        function renderLogsTable(logsArray = logs) {
            logsTableBody.innerHTML = '';
            
            logsArray.forEach(log => {
                const row = document.createElement('tr');
                row.classList.add('border-t', 'border-gray-700', 'hover:bg-gray-750');
                
                row.innerHTML = `
                    <td class="py-3 px-4">${log.id}</td>
                    <td class="py-3 px-4">${formatDateTime(log.dateTime)}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs ${getTypeBadgeClass(log.type)}">${log.type}</span>
                    </td>
                    <td class="py-3 px-4">${log.item}</td>
                    <td class="py-3 px-4">${log.personnel}</td>
                    <td class="py-3 px-4">${log.description}</td>
                    <td class="py-3 px-4">
                        <button class="text-blue-400 hover:text-blue-300 mr-2 edit-btn" data-id="${log.id}">Edit</button>
                        <button class="text-red-400 hover:text-red-300 delete-btn" data-id="${log.id}">Delete</button>
                    </td>
                `;
                
                logsTableBody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editLog(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteLog(id);
                });
            });
        }

        // Apply filters
        function applyFilters() {
            let filteredLogs = logs;
            
            // Search filter
            const searchTerm = searchLogs.value.toLowerCase();
            if (searchTerm) {
                filteredLogs = filteredLogs.filter(log => 
                    log.item.toLowerCase().includes(searchTerm) ||
                    log.personnel.toLowerCase().includes(searchTerm) ||
                    log.description.toLowerCase().includes(searchTerm) ||
                    log.type.toLowerCase().includes(searchTerm)
                );
            }
            
            // Date filter
            const dateFilter = logDateFilter.value;
            if (dateFilter) {
                filteredLogs = filteredLogs.filter(log => 
                    log.dateTime.startsWith(dateFilter)
                );
            }
            
            // Type filter
            const typeFilter = logTypeFilter.value;
            if (typeFilter) {
                filteredLogs = filteredLogs.filter(log => 
                    log.type === typeFilter
                );
            }
            
            renderLogsTable(filteredLogs);
        }

        // Search functionality
        searchLogs.addEventListener('input', applyFilters);
        
        // Date filter
        logDateFilter.addEventListener('change', applyFilters);
        
        // Type filter
        logTypeFilter.addEventListener('change', applyFilters);
        
        // Clear filters
        clearFiltersBtn.addEventListener('click', function() {
            searchLogs.value = '';
            logDateFilter.value = '';
            logTypeFilter.value = '';
            renderLogsTable();
        });

        // Show add log modal
        addLogBtn.addEventListener('click', function() {
            modalTitle.textContent = 'Add New Log Entry';
            logForm.reset();
            logIdInput.value = '';
            
            // Set current date and time
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            document.getElementById('logDateTime').value = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            logModal.classList.remove('hidden');
        });

        // Cancel button in modal
        cancelLogBtn.addEventListener('click', function() {
            logModal.classList.add('hidden');
        });

        // Form submission
        logForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = logIdInput.value ? parseInt(logIdInput.value) : logs.length > 0 ? Math.max(...logs.map(l => l.id)) + 1 : 1;
            const dateTime = document.getElementById('logDateTime').value;
            const type = document.getElementById('logType').value;
            const item = document.getElementById('logItem').value;
            const personnel = document.getElementById('logPersonnel').value;
            const description = document.getElementById('logDescription').value;
            
            if (logIdInput.value) {
                // Edit existing log
                const index = logs.findIndex(l => l.id === parseInt(logIdInput.value));
                if (index !== -1) {
                    logs[index] = { id, dateTime, type, item, personnel, description };
                }
            } else {
                // Add new log
                logs.push({ id, dateTime, type, item, personnel, description });
            }
            
            applyFilters(); // Re-apply any active filters
            logModal.classList.add('hidden');
        });

        // Edit log
        function editLog(id) {
            const log = logs.find(l => l.id === id);
            if (log) {
                modalTitle.textContent = 'Edit Log Entry';
                logIdInput.value = log.id;
                document.getElementById('logDateTime').value = log.dateTime;
                document.getElementById('logType').value = log.type;
                document.getElementById('logItem').value = log.item;
                document.getElementById('logPersonnel').value = log.personnel;
                document.getElementById('logDescription').value = log.description;
                
                logModal.classList.remove('hidden');
            }
        }

        // Delete log
        function deleteLog(id) {
            if (confirm('Are you sure you want to delete this log entry?')) {
                logs = logs.filter(l => l.id !== id);
                applyFilters(); // Re-apply any active filters
            }
        }

        // Initial render
        renderLogsTable();
    </script>
</body>
</html>